# SfM Application Usage

### Build & Dependencies

**Build Instructions**
To compile and run the project, use the standard CMake workflow:

```bash
mkdir build
cd build
cmake ..
make
./SfM
```

**Environment**
We provide a container where all necessary dependencies are pre-installed. The container can be found [here](https://github.com/PuuTzzA/cpp-container). If you prefer to build the project locally, ensure you have a C++20 compatible compiler, CMake (3.20+), and the following libraries installed:

*   **OpenCV**
*   **Eigen3** (v3.3+)
*   **Ceres Solver**
*   **TBB** (Threading Building Blocks)
*   **OpenMP**
*   **libjpeg-turbo** (specifically `libjpeg-turbo8-dev`)

This application performs Structure from Motion (SfM) to reconstruct 3D camera poses and sparse point clouds from a sequence of images.

### Modes of Operation
The code supports two modes controlled by the `#define CALIBRATION` macro:
1.  **Calibration:** Calculates camera intrinsics from checkerboard images.
2.  **Structure from Motion (SfM):** The default mode. This assumes you already have a calibration file (e.g., `../../Data/S21_calibration.json`) and runs the reconstruction pipeline.

### Configuration
Before running the application, update the file paths at the beginning of the `main` function:

*   **`pathToCalibration`**: Path to the pre-calculated JSON file containing camera intrinsics.
*   **`pathToImages`**: Directory containing the input image sequence.
*   **`outputPath`**: The file path where the resulting scene data (JSON) will be saved.
*   **`relativeImageLocation`**: The relative path from the `outputPath` to the image directory. This is required for Blender to correctly load images as camera backgrounds.

**Algorithm Parameters:**
You can tune the reconstruction process by modifying the options structs in `main()` (e.g., `MATCHING_OPTIONS`, `RANSAC_OPTIONS`, `SCENE_OPTIONS`). Please refer to the corresponding header files for a detailed explanation of specific parameters.

### Visualization in Blender
To visualize the computed scene (camera path and point cloud):

1.  Open the Blender project file: `./blender/SfM_test.blend`.
2.  Navigate to the **Scripting** tab.
3.  In the Python script editor, locate the configuration block at the top:
    ```python
    # ================= CONFIGURATION =================
    RELATIVE_PATH = "../../Data/crab.json" 
    # =================================================
    ```
4.  Update `RELATIVE_PATH` to point to the JSON file generated by the C++ application.
5.  Click the **Run** button (play icon). The scene will be imported into the viewport.